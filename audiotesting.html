<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio Transcription</title>
  </head>
  <body>
    <button id="startRecording">Start Recording</button>
    <button id="stopRecording" disabled>Stop Recording</button>
    <div id="transcriptionResult"></div>

    <script>
      let audioChunks = [];
      let mediaRecorder;
      let transcriptionResult = document.getElementById("transcriptionResult");

      navigator.mediaDevices
        .getUserMedia({ audio: true })
        .then((stream) => {
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
          };
          mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            sendAudioToServer(audioBlob);
          };
        })
        .catch((error) => {
          console.error("Error accessing microphone:", error);
        });

      document
        .getElementById("startRecording")
        .addEventListener("click", () => {
          audioChunks = [];
          mediaRecorder.start();
          document.getElementById("startRecording").disabled = true;
          document.getElementById("stopRecording").disabled = false;
        });

      document.getElementById("stopRecording").addEventListener("click", () => {
        mediaRecorder.stop();
        document.getElementById("startRecording").disabled = false;
        document.getElementById("stopRecording").disabled = true;
      });

      function sendAudioToServer(audioBlob) {
        const formData = new FormData();
        formData.append("audio", audioBlob);
        fetch("/process_audio", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Transcription:", data.transcription);
            transcriptionResult.innerText =
              "Transcription: " + data.transcription;
          })
          .catch((error) => console.error("Error processing audio:", error));
      }
    </script>
  </body>
</html>
